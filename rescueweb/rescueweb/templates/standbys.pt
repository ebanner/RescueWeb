<div metal:use-macro="main.macros['template']">
    <div metal:fill-slot="content">
        <h1>${title}</h1>

        <script>
        // List that gets populated with the Standby dates
        var dates = [];
        $(function() {
            function get_updates () {
                $.getJSON('/standby_dates.json', function(data) {
                    // Add random numbers to the unordered list
                    $.each(data, function (key, val) {
                        // Add the start date and end date onto the dates array
                        // for so `highlightDays' knows which dates to highlight.
                        dates.push(val[0]);
                        dates.push(val[1]);
                    });

                    // Display the calendar
                    $('#datepicker').datepicker( {
                        onSelect: function(date) {
                            $.ajax({
                                type: "POST",
                                url: '/standby_info.json',
                                data: { date: date }
                                }).done(function(msg) {
                                    $('#standbys').empty();
                                    $.each(msg, function (key, val) {
                                        // Clear out the standbys display area and
                                        // add all information about the standbys
                                        // happening that day.
                                        $('#standbys').append('Event: ' + val[0] + '<br />');
                                        $('#standbys').append('Location: ' + val[1] + '<br />');
                                        $('#standbys').append('Notes: ' + val[2] + '<br />');
                                        $('#standbys').append('Start date: ' + val[3] + '<br />');
                                        $('#standbys').append('End date: ' + val[4] + '<br />');
                                        $('#standbys').append('<br />');
                                    });
                            });
                        },
                        beforeShowDay: highlightDays
                    });

                    // Highlights the days in the `dates' array
                    function highlightDays(date) {
                        for (var i = 0; i < dates.length; i++) {
                            if (new Date(dates[i]).toString() == date.toString())
                                return [true, 'highlight'];
                        }

                        return [true, ''];
                    }
                });
            }

            // Test Calendar stuff by clicking the title
            $('h1').click(function () {
                get_updates();
            });

            // Get the Standby days from the server and highlight them on the
            // calendar.
            get_updates();

        });
        </script>

        <div id="datepicker" style="float:right;"></div>
        <p id="standbys"><p>
    </div>
</div>
