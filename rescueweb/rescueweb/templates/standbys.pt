<div metal:use-macro="main.macros['template']">
    <div metal:fill-slot="content">
        <p>This is the ${title} page!</p>
        <p>You are all on stand-by, or not, that is all.</p>
        <script>
        // List that gets populated with the Standby dates
        var dates = [];
        $(function() {
            function get_updates () {
                $.getJSON('/standby_dates.json', function(data) {
                    // Add random numbers to the unordered list
                    var target = $('#sidebar ul');
                    $.each(data, function (key, val) {
                        // Add the start date and end date onto the dates array
                        // for so `highlightDays' knows which dates to highlight.
                        dates.push(val[0]);
                        dates.push(val[1]);
                    });

                    // Display the calendar
                    $('#datepicker').datepicker( {
                        onSelect: function(date) {
                            $.ajax({
                                type: "POST",
                                url: '/standby_info.json',
                                data: { date: date }
                                }).done(function(msg) {
                                    $.each(msg, function (key, val) {
                                        // Clear out the standbys display area and
                                        // add all information about the standbys
                                        // happening that day.
                                        $('#standbys').empty();
                                        $('#standbys').append('Event: ' + val[0] + '<br />');
                                        $('#standbys').append('Location: ' + val[1] + '<br />');
                                        $('#standbys').append('Notes: ' + val[2] + '<br />');
                                        $('#standbys').append('Start date: ' + val[3] + '<br />');
                                        $('#standbys').append('End date: ' + val[4] + '<br />');
                                    });
                            });
                        },
                        beforeShowDay: highlightDays
                    });

                    // Highlights the days in the `dates' array
                    function highlightDays(date) {
                        for (var i = 0; i < dates.length; i++) {
                            if (new Date(dates[i]).toString() == date.toString())
                                return [true, 'highlight'];
                        }

                        return [true, ''];
                    }
                });
            }

            get_updates();

            $('#sidebar a').click(function () {
                get_updates();
            });

        });

        </script>
        <div id="sidebar">
            <h2>Updates</h2>
            <ul></ul>
            <p><a href="#">reload</a></p>
        </div>
        <div id="datepicker"></div>
        <p id="standbys"><p>
    </div>
</div>
